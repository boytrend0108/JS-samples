(()=>{"use strict";function t(t,r){var e="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=function(t,r){if(!t)return;if("string"==typeof t)return n(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);"Object"===e&&t.constructor&&(e=t.constructor.name);if("Map"===e||"Set"===e)return Array.from(t);if("Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return n(t,r)}(t))||r&&t&&"number"==typeof t.length){e&&(t=e);var o=0,c=function(){};return{s:c,n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:c}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,s=!1;return{s:function(){e=e.call(t)},n:function(){var t=e.next();return i=t.done,t},e:function(t){s=!0,a=t},f:function(){try{i||null==e.return||e.return()}finally{if(s)throw a}}}}function n(t,n){(null==n||n>t.length)&&(n=t.length);for(var r=0,e=new Array(n);r<n;r++)e[r]=t[r];return e}var r={components:{cartItem:{props:["cartItem","img"],template:'        <div class="cart-item">\n                    <div class="product-bio">\n                        <img :src="img" alt="Some image">\n                        <div class="product-desc">\n                            <p class="product-title">{{cartItem.product_name}}</p>\n                            <p class="product-quantity">Количество: {{cartItem.quantity}}</p>\n                            <p class="product-single-price">{{cartItem.price}}₽ за единицу</p>\n                        </div>\n                    </div>\n                    <div class="right-block">\n                        <p class="product-price">{{cartItem.quantity*cartItem.price}}₽</p>\n                        <button class="del-btn" @click="$emit(\'remove\', cartItem)">&times;</button>\n                        <button class="del-btn" @click="$emit(\'add\', cartItem)" style="background-color:green">+</button>\n                    </div>\n                </div>\n    '}},data:function(){return{imgCart:"https://via.placeholder.com/50x100",cartItems:[],showCart:!1,amount:0,countGoods:0}},mounted:function(){var n=this;this.$parent.getJson("/api/cart").then((function(r){var e,o=t(r.contents);try{for(o.s();!(e=o.n()).done;){var c=e.value;n.cartItems.push(c),n.amount=r.amount,n.countGoods=r.countGoods}}catch(t){o.e(t)}finally{o.f()}}))},template:' <div>\n        <button class="btn-cart" type="button" @click="showCart = !showCart">Корзина</button>\n        <div class="cart-block" v-show="showCart">\n            <p v-if="!cartItems.length">Корзина пуста</p>\n            <cart-item class="cart-item" \n            v-for="item of cartItems" \n            :key="item.id_product"\n            :cartItem="item" \n            :img="imgCart"\n            @remove="remove"\n            @add="addProduct">\n            </cart-item>\n            \x3c!--If cartItems.length exist- we show this div--\x3e\n            <div  class="cart-item" v-if="cartItems.length">\n            <h3>Итого {{amount}}</h3>\n            <button class="del-btn" @click="clearCart">Clear cart</button>\n            </div>\n        </div>\n    </div>',methods:{addProduct:function(t){var n=this,r=this.cartItems.find((function(n){return n.id_product===t.id_product}));if(r){this.$parent.putJson("/api/cart/".concat(r.id_product),{quantity:1}).then((function(t){1===t.result&&(n.amount=t.Cart.amount)})),r.quantity++;r.price,r.quantity}else{var e=Object.assign({quantity:1},{sumPrice:t.price},t);this.$parent.postJson("/api/cart",e).then((function(t){1===t.result&&(n.cartItems.push(e),n.amount=t.Cart.amount)}))}},remove:function(t){var n=this;t.quantity>1?this.$parent.putJson("/api/cart/".concat(t.id_product),{quantity:-1}).then((function(r){1===r.result&&(t.quantity--,n.amount=r.Cart.amount)})):this.$parent.deleteJson("/api/cart/".concat(t.id_product)).then((function(r){1===r.result&&(n.cartItems.splice(n.cartItems.indexOf(t),1),n.amount=r.Cart.amount)}))},clearCart:function(){var t=this;this.$parent.deleteJson("/api/cart/clear").then((function(n){t.cartItems=n.Cart.contents}))}}};function e(t,n){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,n){if(!t)return;if("string"==typeof t)return o(t,n);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return o(t,n)}(t))||n&&t&&"number"==typeof t.length){r&&(t=r);var e=0,c=function(){};return{s:c,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:c}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return i=t.done,t},e:function(t){s=!0,a=t},f:function(){try{i||null==r.return||r.return()}finally{if(s)throw a}}}}function o(t,n){(null==n||n>t.length)&&(n=t.length);for(var r=0,e=new Array(n);r<n;r++)e[r]=t[r];return e}const c={data:function(){return{text:""}},template:'\n    \x3c!--if isVisible === true we show this div--\x3e\n    <div class="error-block" v-if="isVisible"> \n        <p class="error-msg">\n        \x3c!-- we use \'\' in serError couse there will be a string --\x3e\n            <button class="close-btn" @click="setError(\'\')">&times;</button>\n            {{ text }}\n        </p>\n    </div>\n    ',methods:{setError:function(t){this.text=t}},computed:{isVisible:function(){return""!==this.text}}};var a={el:"#app",components:{cart:r,products:{components:{product:{props:["product","img"],template:'\n    <div class="product-item">\n                <img :src="img" alt="Some img">\n                <div class="desc">\n                    <h3>{{product.product_name}}</h3>\n                    <p>{{product.price}}₽</p>\n                    <button class="buy-btn" @click="$root.$refs.cart.addProduct(product)">Купить</button>\n\x3c!-- 2                    <button class="buy-btn" @click="$parent.$parent.$refs.cart.addProduct(product)">Купить</button>--\x3e\n                </div>\n            </div>\n    '}},data:function(){return{products:[],filtered:[],imgCatalog:"https://via.placeholder.com/200x150"}},mounted:function(){var t=this;this.$parent.getJson("/api/products").then((function(n){var r,o=e(n);try{for(o.s();!(r=o.n()).done;){var c=r.value;t.products.push(c),t.filtered.push(c)}}catch(t){o.e(t)}finally{o.f()}}))},methods:{filter:function(t){var n=new RegExp(t,"i");this.filtered=this.products.filter((function(t){return n.test(t.product_name)}))}},template:'\n        <div class="products">\n        \x3c!--:product="itev"- this we send to ProductComp as a props--\x3e\n            <product v-for="item of filtered" :key="item.id_product" :img="imgCatalog" :product="item"></product>\n        </div>\n    '},error:c,search:{data:function(){return{userSearch:""}},template:'\n            <form action="#" class="search-form" @submit.prevent="$parent.$refs.products.filter(userSearch)">\n            \x3c!--Replaced event click to event input--\x3e\n                <input type="text" class="search-field" v-model="userSearch" @input="$parent.$refs.products.filter(userSearch)">\n                <button class="btn-search" type="submit">\n                    <i class="fas fa-search"></i>\n                </button>\n            </form>\n    '}},methods:{getJson:function(t){var n=this;return fetch(t).then((function(t){return t.json()})).catch((function(t){n.$refs.error.setError(t)}))},postJson:function(t,n){var r=this;return fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}).then((function(t){return t.json()})).catch((function(t){r.$refs.error.setError(t)}))},putJson:function(t,n){var r=this;return fetch(t,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}).then((function(t){return t.json()})).catch((function(t){r.$refs.error.setError(t)}))},deleteJson:function(t){var n=this;return fetch(t,{method:"DELETE",headers:{"Content-Type":"application/json"}}).then((function(t){return t.json()})).catch((function(t){n.$refs.error.setError(t)}))}}};new Vue(a)})();
//# sourceMappingURL=main.js.map