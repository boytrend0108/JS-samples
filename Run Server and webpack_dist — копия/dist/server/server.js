(()=>{var t={10:t=>{var e=function(t,e){return t.contents.find((function(t){return t.id_product===+e.params.id}))},n=function(t){t.countGoods=t.contents.reduce((function(t,e){return+t+ +e.quantity}),0),t.amount=t.contents.reduce((function(t,e){return+t+e.sumPrice}),0)},r=function(t,e){return{name:e.body.product_name,newCart:JSON.stringify(t,null,4)}};t.exports={add:function(t,e){return t.contents.push(e.body),e.body.price,n(t),r(t,e)},change:function(t,o){var i=e(t,o);return i.quantity+=o.body.quantity,function(t,e){var n=t.contents[t.contents.indexOf(e)];n.sumPrice=n.price*n.quantity}(t,i),n(t),r(t,o)},remove:function(t,o){var i=e(t,o);return t.contents.splice(t.contents.indexOf(i),1),n(t),r(t,o)}}},967:(t,e,n)=>{function r(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var o=n(860),i=n(147),s=n(886),u=o.Router(),a=n(764),c=n(411).resolve(__dirname,"./db/userCart.json");u.get("/",(function(t,e){i.readFile(c,"utf-8",(function(t,n){t?e.sendStatus(404,JSON.stringify({result:0,text:t})):e.send(n)}))})),u.post("/",(function(t,e){s(t,e,"add",c)})),u.put("/:id",(function(t,e){s(t,e,"change",c)})),u.delete("/:id",(function(t,e){"clear"===t.params.id?i.readFile(c,"utf-8",(function(t,n){var o,s=JSON.parse(n),u=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return r(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var o=0,i=function(){};return{s:i,n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,u=!0,a=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return u=t.done,t},e:function(t){a=!0,s=t},f:function(){try{u||null==n.return||n.return()}finally{if(a)throw s}}}}(s.contents);try{for(u.s();!(o=u.n()).done;){var f=o.value;s.contents.splice(f)}}catch(t){u.e(t)}finally{u.f()}s.amount=0,s.countGoods=0;var l=JSON.stringify(s);i.writeFile(c,l,(function(t){if(t)e.send('{"result": 0}');else{var n=JSON.parse(l);e.send({result:1,Cart:n}),a("Cart","clear all")}}))})):s(t,e,"remove",c)})),t.exports=u},886:(t,e,n)=>{var r=n(147),o=n(10),i=n(764),s={add:o.add,change:o.change,remove:o.remove};t.exports=function(t,e,n,o){r.readFile(o,"utf-8",(function(u,a){if(u)e.sendStatus(404,JSON.stringify({result:0,text:u}));else{var c=s[n](JSON.parse(a),t),f=c.name,l=c.newCart;r.writeFile(o,l,(function(t){if(t)e.send('{"result": 0}');else{i(f,n);var r=JSON.parse(l);e.send({result:1,Cart:r})}}))}}))}},764:(t,e,n)=>{var r=n(245),o=n(147),i=n(411).resolve(__dirname,"./db/stats.json");t.exports=function(t,e){o.readFile(i,"utf-8",(function(n,s){if(n)console.log(n);else{var u=JSON.parse(s);u.push({time:r().format("DD MMM YYYY, h:mm:ss a"),prod_name:t,action:e}),o.writeFile(i,JSON.stringify(u,null,4),(function(t){t&&console.log(t)}))}}))}},860:t=>{"use strict";t.exports=require("express")},245:t=>{"use strict";t.exports=require("moment")},147:t=>{"use strict";t.exports=require("fs")},411:t=>{"use strict";t.exports=require("node:path")}},e={};function n(r){var o=e[r];if(void 0!==o)return o.exports;var i=e[r]={exports:{}};return t[r](i,i.exports,n),i.exports}(()=>{var t=n(860),e=n(147),r=n(967),o=t(),i=n(411);o.use(t.json()),o.use("/",t.static(i.resolve(__dirname,"../public"))),o.use("/api/cart",r);var s=i.resolve(__dirname,"./db/products.json");o.get("/api/products",(function(t,n){e.readFile(s,"utf-8",(function(t,e){t?n.send(JSON.stringify({result:0,text:t})):n.send(e)}))}));var u=process.env.PORT||9999;o.listen(u,(function(){console.log("Server started at port ".concat(u))}))})()})();